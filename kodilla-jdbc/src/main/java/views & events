CREATE TABLE STAT
(
    STAT_ID   INT(11) AUTO_INCREMENT,
    STAT_DATE DATETIME    NOT NULL,
    STAT      VARCHAR(20) NOT NULL,
    VALUE     INT(11)     NOT NULL,
    PRIMARY KEY (STAT_ID)
);

drop view BESTSELLERS_COUNT;
CREATE VIEW BESTSELLERS_COUNT AS
SELECT COUNT(*) AS COUNT
FROM BOOKS
where BESTSELLER > 0;
select *
from BESTSELLERS_COUNT;

DROP EVENT IF EXISTS UPDATE_BESTSELLER_COUNT;
CREATE EVENT UPDATE_BESTSELLER_COUNT
    ON SCHEDULE EVERY 1 YEAR
    DO
    BEGIN

        CALL UpdateBestsellers();

        INSERT INTO STAT (STAT_DATE, STAT, VALUE)
        values (curdate(), 'BESTSELLERS', (SELECT COUNT FROM BESTSELLERS_COUNT));

    END;
SELECT * FROM STAT;